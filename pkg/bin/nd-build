#!/usr/bin/env zsh
set -eu -o pipefail

if [[ ${nd:-} == '' ]]; then
    echo "No flake found at $PWD or up." >&2
    exit 1
fi

if [[ $nd == '-' ]]; then
    exit
fi

# TODO maybe there is some nix cli utility to parse this?
if [[ $nd =~ 'path:(.*)' ]]; then
    f=$match[1]
else
    f=$nd
fi

mkdir -p $f/.nd
nix develop $nd --profile $f/.nd/dev --command true
